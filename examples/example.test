// TestLang++ - Complete Test Suite
// All tests in one file as per assignment spec

config {
  base_url = "http://localhost:8080";
  header "Content-Type" = "application/json";
  header "X-App" = "TestLangDemo";
}

// Variables
let user = "admin";
let password = "1234";
let userId = 42;
let adminRole = "ADMIN";

// Test 1: Login
test Login {
  POST "/api/login" {
    body = "{ \"username\": \"$user\", \"password\": \"$password\" }";
  };
  expect status = 200;
  expect header "Content-Type" contains "json";
  expect body contains "\"token\":";
}

// Test 2: Get User by ID
test GetUserById {
  GET "/api/users/$userId";
  expect status = 200;
  expect body contains "\"id\":42";
  expect body contains "\"username\":";
}

// Test 3: Update User Role
test UpdateUser {
  PUT "/api/users/$userId" {
    body = "{ \"role\": \"$adminRole\" }";
  };
  expect status = 200;
  expect header "X-App" = "TestLangDemo";
  expect header "Content-Type" contains "json";
  expect body contains "\"updated\":true";
  expect body contains "\"role\":\"ADMIN\"";
}

// Test 4: Delete User
test DeleteUser {
  DELETE "/api/users/999";
  expect status = 200;
  expect body contains "\"deleted\":";
}

// Test 5: Another Login Test
test LoginDifferentUser {
  POST "/api/login" {
    header "User-Agent" = "TestLangClient/1.0";
    body = "{ \"username\": \"testuser\", \"password\": \"test123\" }";
  };
  expect status = 200;
  expect body contains "\"token\":";
}
